import{e as R,d as z,r as c,j as e}from"./react-vendor-BJ-6AA60.js";import{doc as $,getDoc as T,serverTimestamp as C,collection as O,addDoc as q}from"./firebase-firestore-CCnivBKz.js";import{ref as B,uploadBytes as M,getDownloadURL as Z}from"./firebase-storage-CqamIgiF.js";import{u as H,H as G,d as U,s as _}from"./index-CVvBu09D.js";import{u as K}from"./form-vendor-DOrZhWSe.js";import"./firebase-app-CzzSlWfx.js";const te=()=>{var w,k,F,S;const{jobId:u}=R(),p=z(),{currentUser:n,userProfile:t}=H(),[l,x]=c.useState(null),[g,b]=c.useState(!0),[f,j]=c.useState(!1),[h,a]=c.useState(null),[v,E]=c.useState(!1),[y,N]=c.useState(null),{register:d,handleSubmit:L,formState:{errors:m}}=K({defaultValues:{email:(n==null?void 0:n.email)||"",phoneNumber:(t==null?void 0:t.phoneNumber)||"",linkedinUrl:((w=t==null?void 0:t.profile)==null?void 0:w.linkedin)||"",portfolioUrl:((k=t==null?void 0:t.profile)==null?void 0:k.portfolio)||""}});t==null||t.role,c.useEffect(()=>{if(!n){p("/login",{state:{from:`/job-application/${u}`}});return}if(t&&t.role!=="werkzoekende"){a("Alleen werkzoekenden kunnen solliciteren"),b(!1);return}(async()=>{if(!u){a("Geen vacature ID gevonden"),b(!1);return}try{b(!0);const o=$(U,"jobs",u),i=await T(o);if(i.exists()){const r=i.data();x({id:i.id,title:r.title||"Onbekende functie",company:r.company||"Onbekend bedrijf",location:r.location||"Locatie onbekend",description:r.description||"Geen beschrijving beschikbaar",salary:r.salary,isFullTime:r.isFullTime,isRemote:r.isRemote,status:r.status,requirements:r.requirements,createdAt:r.createdAt,updatedAt:r.updatedAt,userId:r.userId,recruiterId:r.recruiterId}),a(null)}else a("Vacature niet gevonden"),x(null)}catch(o){console.error("Fout bij het ophalen van vacaturedetails:",o),a("Er is een fout opgetreden bij het laden van de vacature"),x(null)}finally{b(!1)}})()},[u,n,p,t]);const I=async s=>{if(!n)throw new Error("Niet ingelogd");const o=s.name.split(".").pop(),i=`cv_${n.uid}_${Date.now()}.${o}`,r=B(_,`cv/${i}`);return await M(r,s),Z(r)},A=async s=>{var o;if(!n||!l||!l.recruiterId){a("Er ontbreken gegevens om de sollicitatie te kunnen versturen");return}try{j(!0),a(null);let i=((o=t==null?void 0:t.profile)==null?void 0:o.cv)||"";s.cv&&s.cv.length>0&&(i=await I(s.cv[0]));const r={jobId:l.id,userId:n.uid,recruiterId:l.recruiterId,jobTitle:l.title,companyName:l.company,applicantName:(t==null?void 0:t.displayName)||n.displayName||"",motivationLetter:s.motivationLetter,cvUrl:i,phoneNumber:s.phoneNumber||"",email:s.email,linkedinUrl:s.linkedinUrl||"",portfolioUrl:s.portfolioUrl||"",status:"pending",applicationDate:C(),updatedAt:C(),notes:s.additionalNotes||""},J=O(U,"sollicitaties");await q(J,r),E(!0),setTimeout(()=>{p("/dashboard")},3e3)}catch(i){console.error("Fout bij het versturen van de sollicitatie:",i),i.code==="permission-denied"?a("Je hebt niet de juiste rechten om een sollicitatie te versturen. Zorg ervoor dat je bent ingelogd als werkzoekende."):i.code==="unavailable"||i.code==="network-request-failed"?a("Er is een netwerkprobleem opgetreden. Controleer je internetverbinding en probeer het opnieuw."):i.code==="storage/unauthorized"?a("Je hebt niet de juiste rechten om je CV te uploaden. Zorg ervoor dat je bent ingelogd als werkzoekende."):a("Er is een fout opgetreden bij het versturen van je sollicitatie. Probeer het later opnieuw of neem contact op met de helpdesk.")}finally{j(!1)}},D=s=>{s.target.files&&s.target.files.length>0?N(s.target.files[0].name):N(null)},V=()=>{p(`/job/${u}`)};return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsx(G,{}),e.jsx("div",{className:"container mx-auto px-4 py-12 mt-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("button",{onClick:V,className:"mb-6 flex items-center text-primary-600 hover:text-primary-800",children:[e.jsx("svg",{className:"w-5 h-5 mr-1",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Terug naar vacature"]}),g&&e.jsxs("div",{className:"flex justify-center items-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600"}),e.jsx("span",{className:"ml-3",children:"Vacature details laden..."})]}),h&&e.jsxs("div",{className:"bg-red-50 text-red-700 p-6 rounded-lg mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Er is een probleem opgetreden"}),e.jsx("p",{children:h})]}),v&&e.jsxs("div",{className:"bg-green-50 text-green-700 p-6 rounded-lg mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Sollicitatie verstuurd!"}),e.jsx("p",{children:"Je sollicitatie is succesvol verstuurd. Je wordt nu doorgestuurd naar je dashboard."})]}),!g&&!h&&l&&!v&&e.jsxs("div",{className:"bg-white shadow-lg rounded-lg overflow-hidden border border-gray-200",children:[e.jsxs("div",{className:"bg-primary-50 p-6 border-b border-gray-200",children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800 mb-2",children:["Solliciteren op: ",l.title]}),e.jsxs("p",{className:"text-gray-600",children:[l.company," • ",l.location]})]}),e.jsxs("form",{onSubmit:L(A),className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"motivationLetter",children:["Motivatiebrief ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{...d("motivationLetter",{required:"Motivatiebrief is verplicht"}),id:"motivationLetter",rows:8,className:`w-full px-3 py-2 border ${m.motivationLetter?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500`,placeholder:"Vertel waarom je geïnteresseerd bent in deze functie en waarom je de ideale kandidaat bent..."}),m.motivationLetter&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.motivationLetter.message})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"cv",children:"Upload je CV (PDF)"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"file",...d("cv"),id:"cv",className:"hidden",accept:".pdf,.doc,.docx",onChange:D}),e.jsx("label",{htmlFor:"cv",className:"cursor-pointer px-4 py-2 bg-gray-100 text-gray-800 rounded-md border border-gray-300 hover:bg-gray-200",children:"Kies bestand"}),e.jsx("span",{className:"ml-3 text-sm text-gray-500",children:y||((F=t==null?void 0:t.profile)!=null&&F.cv?"Bestaand CV wordt gebruikt":"Geen bestand gekozen")})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:(S=t==null?void 0:t.profile)!=null&&S.cv?"Je hebt al een CV geüpload in je profiel. Als je geen nieuw bestand kiest, gebruiken we je bestaande CV.":"Maximaal 5MB. Ondersteunde formaten: PDF, DOC, DOCX"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-gray-800",children:"Contactgegevens"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"email",children:["E-mailadres ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{...d("email",{required:"E-mailadres is verplicht",pattern:{value:/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,message:"Voer een geldig e-mailadres in"}}),type:"email",id:"email",className:`w-full px-3 py-2 border ${m.email?"border-red-500":"border-gray-300"} rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500`,placeholder:"jouw@email.nl"}),m.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:m.email.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"phoneNumber",children:"Telefoonnummer"}),e.jsx("input",{...d("phoneNumber"),type:"tel",id:"phoneNumber",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"06 12345678"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3 text-gray-800",children:"Online profielen"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"linkedinUrl",children:"LinkedIn URL"}),e.jsx("input",{...d("linkedinUrl"),type:"url",id:"linkedinUrl",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"https://linkedin.com/in/jouwnaam"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"portfolioUrl",children:"Portfolio / Website"}),e.jsx("input",{...d("portfolioUrl"),type:"url",id:"portfolioUrl",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"https://jouwportfolio.nl"})]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",htmlFor:"additionalNotes",children:"Extra informatie"}),e.jsx("textarea",{...d("additionalNotes"),id:"additionalNotes",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Is er nog iets anders dat je wilt delen met de recruiter?"})]}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{type:"submit",disabled:f,className:"w-full md:w-auto px-6 py-3 bg-primary-600 text-white font-medium rounded-md hover:bg-primary-700 transition-colors flex items-center justify-center disabled:bg-primary-400",children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white mr-2"}),"Versturen..."]}):"Sollicitatie versturen"})})]})]})]})})]})};export{te as default};
//# sourceMappingURL=JobApplication-DIvE025R.js.map
